{"changed":false,"filter":false,"title":"OTG2prime.mos","tooltip":"/OTG2prime.mos","value":"\r\n! Chapucilla linealizaci�n tres �ndices\r\nmodel \"hcon\" \r\nuses 'mmxprs', 'mmive', 'mmsystem','mmjobs'\r\n\r\n\r\nparameters\r\n\tr=1\r\n\tt=71\r\n\ttmax=200.00\r\nend-parameters\r\n\r\n(!\r\ndeclarations\r\n datos:array(1..3) of integer\r\nend-declarations\r\n\r\n!datos::[1,10,7200]\r\n\r\nr:=datos(1)\r\nt:=datos(2)\r\ntmax:=datos(3)\r\n!)\r\n(!\r\n\r\ndeclarations\r\n\tr,t,tmax:integer\r\nend-declarations\r\n\r\n\r\ninitializations from \"raw:\"\r\n\tr as \"shmem:r\"\r\n\tt as \"shmem:t\"\r\n\ttmax as \"shmem:tmax\"\r\nend-initializations\r\n!)\r\n\r\n\r\n!setparam(\"XPRS_VERBOSE\",true)\r\nsetparam(\"XPRS_PRESOLVE\",1)\r\n!setparam(\"XPRS_VERBOSE\",2)\r\nsetparam(\"XPRS_CUTSTRATEGY\",0)\r\n\r\ndeclarations\r\n\tn:integer\r\nend-declarations\r\n\r\nfopen(\"Beasley\"+r+\".txt\",F_INPUT)\r\nread(n)\r\n\r\ndeclarations\r\n\ttotaltime,relaxtime,oflin,ofint,bestbound,gap1,gap3 : real\r\n\tnod,status,p:integer\r\n\tDelta,lambda : array(1..n) of real\r\n\tcc: array(1..n, 1..n) of real\r\n\td: array(1..n*n) of real\r\n\tc: array(0..n*n) of real\r\n\tx: array(1..n,1..n) of mpvar\r\n\ty: array(1..n)  of mpvar\r\n\tOTz: array(range,range) of mpvar  \r\n\tOTt: array(range) of mpvar \r\n\tr1,r2 : range\r\n\tteta : dynamic array(1..n,1..n,r1) of mpvar\r\n\tu : dynamic array(1..n,r2) of mpvar\r\nend-declarations\r\n\r\n\r\n\r\nEPS:=10^(-6)\r\n\r\nreadln(p)\r\nforall(i in 1..n)do\r\n forall(j in 1..n)read(cc(i,j))\r\n readln\r\nend-do\r\nfclose(F_INPUT)\r\nla := \"lambdaT\"+t+\"_\"+n+\".txt\"\r\nfopen(la,F_INPUT)\r\nforall(k in 1..n )read(lambda(k))\r\nfclose(F_INPUT)\r\n\r\nforall (i,j in 1..n) d((i-1)*n+j):=cc(i,j)\r\nqsort(true,d)\r\n\r\nbeta:=0\r\nforall (i in 1..n | d(i)=0) beta+=1\r\n!writeln(\"beta: \",beta)\r\nc(0):=0\r\n!c(1):=0\r\n\r\nG:=0\r\nforall (i in 1..n*n-1|d(i)<>0) \r\nif (d(i)<>d(i+1)) then\r\n G+=1\r\n c(G):=d(i)\r\nend-if\r\nif (d(n*n)<>d(n*n-1)) then \r\n G+=1\r\n c(G):=d(n*n)\r\nend-if\r\n\r\nDelta(1):=lambda(1)\r\nforall (i in 2..n) Delta(i):=lambda(i)-lambda(i-1)\r\nalfa:=0\r\nwhile (Delta(alfa+1)>=0 and alfa<n-1) alfa+=1\r\n\r\nforall(k in 1..n | Delta(k)>0) do\r\n forall(i in 1..n) create(OTz(i,k))\t\t\r\n create(OTt(k))\r\nend-do\r\n\r\nmaxkneg:=0\r\ncontneg:=0\r\nforall(k in 1..n | Delta(k)<0) do\r\n maxkneg:=k\r\n contneg+=1\r\n forall(i,j in 1..n) create(teta(i,j,k))\t\t\r\n !forall(i in 1..n) create(u(i,k))\r\nend-do\r\nfinalize(r1)\r\nfinalize(r2)\r\n\r\ndeclarations\r\n\tindexkneg:array(1..contneg)of integer\r\nend-declarations\r\ncontador:=0\r\nforall(k in 1..n | Delta(k)<0)do\r\n\tcontador+=1\r\n\tindexkneg(contador):=k\r\nend-do\r\n\r\n!PREPROCESO costes que nunca vamos a afrontar\r\n\r\ndeclarations\r\n\tmayact:real\r\n\tJMAYORES:set of integer\r\nend-declarations\r\nforall(i in 1..n)do\r\n\tfuera:=0\r\n\tJMAYORES:={}\r\n\trepeat\r\n\t\tmayact:=0\r\n\t\tforall(j in 1..n|j not in JMAYORES)do\r\n\t\t\tif(cc(i,j)>mayact)then\r\n\t\t\t\tmayact:=cc(i,j)\r\n\t\t\t\tcolumna:=j\r\n\t\t\tend-if\r\n\t\tend-do\r\n\t\tquedan:=count(j in 1..n|mayact=cc(i,j) and j not in JMAYORES)\r\n\t\tif(getsize(JMAYORES)+quedan < p)then\r\n\t\t\tJMAYORES:=JMAYORES+{columna}\r\n\t\telse\r\n\t\t\tfuera:=1\r\n\t\tend-if\r\n\tuntil(fuera=1)\r\n\tforall(j in JMAYORES)do\r\n\t\tx(i,j)=0\r\n\t\tforall(k in 1..n|Delta(k)<0)teta(i,j,k)=0\r\n\tend-do\r\nend-do\r\n\r\n!FIN PREPROCESO\r\n\r\nsum(j in 1..n) y(j) = p\r\nforall(i in 1..n) sum(j in 1..n) x(i,j)=1\r\nforall (i,j in 1..n) x(i,j)-y(j)<=0\r\nforall(j in 1..n) y(j) is_binary\r\n\r\n!forall (i in 1..n,j in 1..n) x(i,j) is_binary\r\n\r\nforall(i in 1..n,k in 1..n | Delta(k)>0) \r\n OTt(k) + OTz(i,k) - sum(j in 1..n) cc(i,j)*x(i,j) >= 0\r\n\r\n! Nuestro modelo OT-Theta \r\n\r\nforall(k in 1..n | Delta(k)<0) do\r\n sum(i,j in 1..n) teta(i,j,k) = n-k+1\r\n forall(i,j in 1..n) teta(i,j,k) <= x(i,j)\r\nend-do\r\n\r\n! Fin nuestro modelo OT-Theta\r\n\r\n\r\n\r\n\r\n\r\n(!desigualdades v�lidas que empeoran el tiempo\r\nforall(kk in 2..contneg,i in 1..n)do\r\n\t!u(i,indexkneg(kk))<=u(i,indexkneg(kk-1))\r\n\tforall(j in 1..n)teta(i,j,indexkneg(kk))<=teta(i,j,indexkneg(kk-1))\r\nend-do\r\n!)\r\n!CAC\r\n!forall(i,j,jj in 1..n | cc(i,j)>cc(i,jj)) x(i,j) <= 1-y(jj)\r\nforall(i,jj in 1..n)sum(j in 1..n | cc(i,j)>cc(i,jj)) x(i,j) <= 1-y(jj)\r\n\r\n\r\n(! Des. v�lidas\r\nforall(k in 1..maxkneg-1 | Delta(k)<0) do\r\n ele:=k\r\n repeat ele+=1; until Delta(ele)<0\r\n forall(i in 1..n) u(i,k)>=u(i,ele)\r\n forall(i,j in 1..n) teta(i,j,k)>=teta(i,j,ele)\r\nend-do\r\n!)\r\n\r\n(!Sk<=Sk-1\r\nforall(k in 2..n)do\r\n\tif(Delta(k)<0 and Delta(k-1)<0)then\r\n\t\tsum(i,j in 1..n)cc(i,j)*teta(i,j,k)<=sum(i,j in 1..n)cc(i,j)*teta(i,j,k-1)\r\n\telif(Delta(k)>0 and Delta(k-1)<0)then\r\n\t\t(n-k+1)*OTt(k)+sum(i in 1..n)OTz(i,k)<=sum(i,j in 1..n)cc(i,j)*teta(i,j,k-1)\r\n\telif(Delta(k)<0 and Delta(k-1)>0)then\r\n\t\tsum(i,j in 1..n)cc(i,j)*teta(i,j,k)<=(n-(k-1)+1)*OTt(k-1)+sum(i in 1..n)OTz(i,k-1)\r\n\telif(Delta(k)>0 and Delta(k-1)>0)then\r\n\t\t(n-k+1)*OTt(k)+sum(i in 1..n)OTz(i,k)<=(n-(k-1)+1)*OTt(k-1)+sum(i in 1..n)OTz(i,k-1)\r\n\tend-if\r\nend-do\r\n!)\r\n\r\nobjective:=\r\nsum(k in 1..n|Delta(k)>0) Delta(k)*((n-k+1)*OTt(k)+sum(i in 1..n) OTz(i,k))+\r\nsum(k in 1..n|Delta(k)<0,i,j in 1..n) Delta(k)*cc(i,j)*teta(i,j,k)\r\n\r\npreprotime:=gettime\r\n\r\nminimize(XPRS_LIN,objective)\r\n\r\n\r\noflin:=getobjval\r\nrelaxtime:=gettime-preprotime\r\n\r\nsetparam(\"XPRS_MAXTIME\",-(tmax))!+relaxtime))\r\n\r\n\r\nminimize(objective)\r\n\r\nbestbound:=getparam(\"XPRS_BESTBOUND\")\r\nnod:=getparam(\"XPRS_NODES\")\r\nofint:=getobjval\r\nstatus:=getparam(\"XPRS_MIPSTATUS\")\r\n\r\ngap1:=(ofint-oflin)/ofint*100!integrality gap de la formulaci�n DOMP6\r\ngap3:=(ofint-bestbound)/ofint*100!Gap para cerrar la soluci�n\r\n\r\ntotaltime:=gettime-relaxtime-preprotime\r\n\r\nwriteln(\"OTG2'  \",strfmt(t,15),strfmt(r,12),strfmt(n,9),strfmt(p,4),strfmt(totaltime,10,2),strfmt(relaxtime,12,2),strfmt(preprotime,12,2),strfmt(oflin,20,2),strfmt(ofint,20,2),strfmt(gap1,8,2),strfmt(nod,7),strfmt(status,9),strfmt(bestbound,20,2),strfmt(gap3,20,2))\r\n\r\nfopen(\"ResultsOTG2Prime2.csv\",F_OUTPUT+F_APPEND)\r\n\r\nwriteln(\"OTG2'  \",strfmt(t,15),strfmt(r,12),strfmt(n,9),strfmt(p,4),strfmt(totaltime,10,2),strfmt(relaxtime,12,2),strfmt(preprotime,12,2),strfmt(oflin,20,2),strfmt(ofint,20,2),strfmt(gap1,8,2),strfmt(nod,7),strfmt(status,9),strfmt(bestbound,20,2),strfmt(gap3,20,2))\r\n\r\n\r\n(!\r\nwriteln(\"oflin:     \",oflin)\r\nwriteln(\"ofint:     \",ofint)\r\nwriteln(\"relaxtime: \",relaxtime)\r\nwriteln(\"totaltime: \",totaltime)\r\nwriteln(\"gap1:      \",gap1)\r\nwriteln(\"nod:       \",nod)\r\nwriteln(\"n:         \",n)\r\nwriteln(\"p:         \",p)\r\nwriteln(\"status:    \",status)\r\nwriteln(\"bestbound: \",bestbound)\r\nwriteln(\"gap3:      \",gap3)\r\n\r\n\r\ninitializations to \"raw:\"\r\n\toflin as \"shmem:oflin\"\r\n\tofint as \"shmem:ofint\"\r\n\tpreprotime as \"shmem:preprotime\"\r\n\trelaxtime as \"shmem:relaxtime\"\r\n\ttotaltime as \"shmem:totaltime\"\r\n\tgap1 as \"shmem:gap1\"\r\n\tnod as \"shmem:nod\"\r\n\tstatus as \"shmem:status\"\r\n\tn as \"shmem:n\"\r\n    p as \"shmem:p\"\r\n\tbestbound as \"shmem:bestbound\"\r\n\tgap3 as \"shmem:gap3\"\r\nend-initializations\r\n!)\r\n\r\nend-model\r\n","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1576261372000}